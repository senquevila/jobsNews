var cheerio = require('cheerio')
  , download = require('download.js')
  , url = "http://www.empleos.hn/index.php?cat=90"
  , localhost = "http://www.empleos.hn/"
  , element = "table#joblist tr";

module.exports = function (limit, buff) {
  for (var i = 0; i < limit; i++) {
    var offset = i * 10;
    var p_url = url + '&offset=' + offset;

    download(p_url, function(data) {
      if (data) {
        var $ = cheerio.load(data.toString('utf-8'));
        buff = '<table>';

        $(element).each(function(i, e) {
          buff += '<tr>';

          /*var child = $(e.children)[i];

          if (i == 1) {
            console.log(i + '::' + $(child).text().trim());
          } */       
          
          $(e.children).each(function(j, e1){
            var childrenStr = $(e1.children).text().trim();
            var bShow/* = false*/;
            var diff = 0;
            var find = 0;

            if (i == 0)
              bShow = true;
            /*else if (i > 0 && j == 1) {
              var hoy = new Date();
              var fecha = new Date(childrenStr);
              diff = (hoy - fecha) / 1000 / 3600 / 24;
              if (diff > 1000) {
                bShow = false;
              } else {
                bShow = true;
                find = i;
              }
            }

            if (i == find)
              bShow = true;

            if (bShow)*/
              buff += '<td>' + childrenStr + '</td>';
            
          });

          buff += '</tr>';
        });
          
        buff += '</table';
      }
      else 
        console.error("error");  
    });
  }
}